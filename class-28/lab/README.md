# Lab: Log Clearing

## Overview

Defense evasion as documented in TA0005 is an important tactic used by threat actors to avoid detection by defensive systems. By damaging the integrity of event logs, threat actors hope to not only avoid detection but may also seek to avoid prosecution and accountability for their actions on objectives. T1070 tells us that threat actors will often go to great lengths to cover their tracks by deleting evidence of their actions. One such method is log clearing, which we'll explore today as our sample technique to which we'll apply the Atomic Testing Cycle.

## Scenario

In today's Zoom call, Director Dyson seemed optimistic. "I've reviewed your report on the threat reproduction, great work. Some news has come to light from our own DFIR specialist who notified me last night that several critical log files were deleted during the security incident. This explains why my analyst teams have been struggling to produce evidence of the attack. I'd like you to model out what it takes to do something like this, and recommend some detective controls for this."

## Objectives

- Reproduce a log clearing attack (T1070.001)
- Implement countermeasures against it

## Resources

- [Atomic Red Team T1070.001](https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.001/T1070.001.md){:target="_blank"}
- [Atomic Testing Cycle](https://atomicredteam.io/){:target="_blank"}

## Tasks

### Part 1: Staging

You'll need a Windows 10 VM that is forwarding logs to Splunk using Universal Forwarder. All of this is pre-staged in [Term2-baseline-lab-v3.zip Download (25 GB)](https://codefellows.github.io/ops-401-cybersecurity-guide/curriculum/#downloads-table){:target="_blank"}.

### Part 2: Log Clearing

At Cyberdyne Systems, an intruder with administrator clearance attempted to "cover their tracks" by removing indicators of their activities. Let's reproduce one of the common techniques used by such adversaries in order to formulate defenses against them for our client.
- Execute both of the following Atomic Tests as documented in the Atomic Red Team repo, entry T1070.001:
  - Atomic Test #1 - Clear Logs
  - Atomic Test #2 - Delete System Logs Using Clear-EventLog
- What are the conditions or requirements needed in order for the attacker to perform this kind of activity on the system?
- Document the steps you took and your findings.
  - Verify that your log clearing operation was successful in Win10.
  - Check whether this impacted the logs stored on your SIEM.
- Analyze the event log(s) generated by your test.
  - What type of event log is this, Sysmon or regular Windows?
  - What is the nature of this event log (what category does it fall into)?
  - How does the event log indicate the user account that executed the log clearing operation?
- Take a look at Atomic Test #3 - Clear Event Logs via VBA and explain how this test works. Why does it require MS Word, and what about MS Word does it exploit?

### Part 3: Detection

- For both Atomic Tests 1 and 2, can you find evidence of the log clearing activity on a Windows 10 endpoint that is forwarding logs to Splunk.
- What kind of security defenses does this technique bypass, assuming the adversary has elevated privileges on a Windows 10 endpoint?

### Part 4: Choose Your Adventure

- Explore the Atomic Red Team repository in conjunction with MITRE ATT&CK and select an interesting TTP.
- Perform a full Atomic Testing Cycle as you did above.

### Part 5: Reporting

- Report on all completed Atomic Testing Cycles using the chosen Atomic Test. Describe in today's submission the following stages of the Atomic Testing Cycle:
  1. Execute Test
  1. Collect Evidence
  1. Develop Detection
- Review and discuss the suggested mitigations on MITRE ATT&CK for each technique.

## Stretch Goals (Optional Objectives)

Run further Atomic Tests to increase your exposure to MITRE ATT&CK and Atomic Red Team. If you've thought of an interesting Atomic Test of your own, consider contributing to the project.

## Submission Instructions

1. Create a new blank Google Doc. Include above assignment submission text and images within this Google Doc.
1. Name the document according to your course code and assignment.
   - i.e. `seattle-ops-401d1: Reading 01` or `seattle-ops-401d1: Lab 04`.
1. Add your name & date at the top of the Google Doc.
1. Share your Google Doc so that "Anyone with the link can view".
1. Paste the link to your Google Doc in the discussion field below and share an observation from your experience in this lab.
